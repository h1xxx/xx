# general arch options
# ====================

# optimize very unlikely/likely branches
CONFIG_JUMP_LABEL=y

CONFIG_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_RANDOMIZE_KSTACK_OFFSET_DEFAULT=y

CONFIG_VMAP_STACK=y
CONFIG_GCC_PLUGINS=y
CONFIG_GCC_PLUGIN_LATENT_ENTROPY=y
CONFIG_GCC_PLUGIN_RANDSTRUCT=y


# processor
# =========

CONFIG_SMP=y


# memory
# ======

CONFIG_MEMORY_ISOLATION=y
CONFIG_MEMORY_FAILURE=y
CONFIG_HWPOISON_INJECT=y


# mitigations
# ===========

CONFIG_SPECULATION_MITIGATIONS=y
CONFIG_RETPOLINE=y
CONFIG_RETHUNK=y
CONFIG_SLS=y


# security
# ========

CONFIG_SECURITY=y

# restrict unprivileged access to the kernel syslog
CONFIG_SECURITY_DMESG_RESTRICT=y

CONFIG_PAGE_TABLE_ISOLATION=y

# harden memory copies between kernel and userspace
CONFIG_HARDENED_USERCOPY=y

# allow usercopy whitelist violations to fallback to object size
# todo: maybe can be removed
CONFIG_HARDENED_USERCOPY_FALLBACK=y

CONFIG_FORTIFY_SOURCE=y
CONFIG_SECURITY_LOADPIN=y
CONFIG_SECURITY_LOADPIN_ENFORCE=y
CONFIG_INTEGRITY=y

CONFIG_GCC_PLUGIN_STRUCTLEAK=y
CONFIG_GCC_PLUGIN_STACKLEAK=y
CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL=y

CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y
CONFIG_INIT_ON_FREE_DEFAULT_ON=y

CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y

CONFIG_ZERO_CALL_USED_REGS=y

