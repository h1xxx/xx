[ src ]

url = https://github.com/OpenPrinting/cups/releases/download/v<ver>/cups-<ver>-source.tar.gz
src_type = tar
src_dirname = <prog>-<ver>



[ vars ]



[ std ]

env = CFLAGS+=-fPIC
prepare = tar --no-same-owner -xf <src_path> -C <tmp_dir>
configure = export DSOFLAGS=${LDFLAGS} &&
	./configure
	--sysconfdir=/etc
	--localstatedir=/var
	--sbindir=/usr/bin
	--libdir=/usr/lib
	--with-logdir=/var/log/cups
	--with-docdir=/usr/share/cups/doc
	--with-exe-file-perm=0755
	--with-cups-user=209
	--with-cups-group=209
	--with-max-log-size=0
	--enable-libusb
	--enable-ssl=yes
	--enable-raw-printing
	--enable-relro
	--enable-sanitizer
	--enable-libpaper
	--with-optim="${CFLAGS}"
	--without-dnssd-libs
	--disable-webif
	--disable-pam
	--disable-dbus
	--disable-dnssd
	--disable-launchd
	--disable-systemd
	--disable-threads
	--disable-acl
	--disable-avahi
	--disable-unit-tests
	--disable-static

build = export DSOFLAGS=${LDFLAGS} && make
pkg_create = make BUILDROOT=<pkg_dir> install &&
	rm -r 	<pkg_dir>/var/
		<pkg_dir>/etc/rc*
		<pkg_dir>/usr/share/cups/{[a-l]*,model,profiles,templates}/
		<pkg_dir>/usr/share/locale/{[a-d]*,es,[f-z]*}/ &&
		chmod -Rv u+w <pkg_dir>/ || : &&
		mv <pkg_dir>/etc/ <pkg_dir>/usr/share/
