[ src ]

url = https://github.com/shadow-maint/shadow/releases/download/<ver>/shadow-<ver>.tar.xz
src_type = tar
src_dirname = <prog>-<ver>



[ vars ]



[ std ]

env =
prepare = tar --no-same-owner -xf <src_path> -C <tmp_dir>

# sed ... groups ...: disable installation of the groups program already
# 	included in coreutils
# find ...: prevent installation of already installed manual pages
# sed ... ENCRYPT ...: use SHA512 for password hashing
# sed -i '/selinux ...: remove selinux references
# sed -i 's/1000 ...: make the first group number generated by useradd 1000
configure = sed -i 's/groups$(EXEEXT) //' src/Makefile.in &&
	find man -name Makefile.in -exec sed -i 's/groups\\.1 / /'   {} \\; &&
	find man -name Makefile.in -exec sed -i 's/getspnam\\.3 / /' {} \\; &&
	find man -name Makefile.in -exec sed -i 's/passwd\\.5 / /'   {} \\; &&
	sed -i 's|#ENCRYPT_METHOD DES|ENCRYPT_METHOD SHA512|'
		etc/login.defs &&
	sed -i '/selinux/d' etc/pam.d/* &&
	sed -i 's/1000/999/' etc/useradd &&
	./configure
	--prefix=/usr
	--bindir=/usr/bin
	--sbindir=/usr/sbin
	--exec-prefix=/usr
	--sysconfdir=/etc
	--with-group-name-max-length=32
	--disable-nls
	--disable-dependency-tracking
	--without-libpam
	--without-selinux
	--without-btrfs
	--without-acl
	--without-attr
	--without-nscd
	--without-sssd
	--without-tcb

build = make
pkg_create = make DESTDIR=<pkg_dir> install



[ musl ]

env = CC="musl-gcc -static"
prepare = tar --no-same-owner -xf <src_path> -C <tmp_dir>

# sed ... groups ...: disable installation of the groups program already
# 	included in coreutils
# find ...: prevent installation of already installed manual pages
# sed ... ENCRYPT ...: use SHA512 for password hashing
# sed -i '/selinux ...: remove selinux references
# sed -i 's/1000 ...: make the first group number generated by useradd 1000
configure = sed -i 's/groups$(EXEEXT) //' src/Makefile.in &&
	find man -name Makefile.in -exec sed -i 's/groups\\.1 / /'   {} \\; &&
	find man -name Makefile.in -exec sed -i 's/getspnam\\.3 / /' {} \\; &&
	find man -name Makefile.in -exec sed -i 's/passwd\\.5 / /'   {} \\; &&
	sed -i 's|#ENCRYPT_METHOD DES|ENCRYPT_METHOD SHA512|'
		etc/login.defs &&
	sed -i '/selinux/d' etc/pam.d/* &&
	sed -i 's/1000/999/' etc/useradd &&
	./configure
	--prefix=
	--with-group-name-max-length=32
	--disable-nls
	--disable-dependency-tracking
	--without-libpam
	--without-selinux
	--without-btrfs
	--without-acl
	--without-attr
	--without-nscd
	--without-sssd
	--without-tcb

build = make
pkg_create = make DESTDIR=<pkg_dir> install



[ bootstrap ]

env =
prepare = tar --no-same-owner -xf <src_path> -C <tmp_dir>

# sed ... groups ...: disable installation of the groups program already
# 	included in coreutils
# find ...: prevent installation of already installed manual pages
# sed ... ENCRYPT ...: use SHA512 for password hashing
# sed -i '/selinux ...: remove selinux references
# sed -i 's/1000 ...: make the first group number generated by useradd 1000
configure = sed -i 's/groups$(EXEEXT) //' src/Makefile.in &&
	find man -name Makefile.in -exec sed -i 's/groups\\.1 / /'   {} \\; &&
	find man -name Makefile.in -exec sed -i 's/getspnam\\.3 / /' {} \\; &&
	find man -name Makefile.in -exec sed -i 's/passwd\\.5 / /'   {} \\; &&
	sed -i 's|#ENCRYPT_METHOD DES|ENCRYPT_METHOD SHA512|'
		etc/login.defs &&
	sed -i '/selinux/d' etc/pam.d/* &&
	sed -i 's/1000/999/' etc/useradd &&
	./configure
	--prefix=/usr
	--bindir=/usr/bin
	--sbindir=/usr/sbin
	--sysconfdir=/etc
	--with-group-name-max-length=32
	--disable-nls
	--disable-dependency-tracking
	--without-libpam
	--without-selinux
	--without-btrfs
	--without-acl
	--without-attr
	--without-nscd
	--without-sssd
	--without-tcb

build = make
pkg_create = make DESTDIR=<pkg_dir> install

